{
    "collab_server" : "",
    "contents" : "#Working code for WGDR development\n#Ryan Collins\n#Talkowski Lab\n#Fall 2016\n\n#Load library\nrequire(WGDR)\n\n#Set params\noptions(scipen=1000)\nWRKDIR <- \"/Users/collins/Desktop/RCollins/Talkowski_Local/NGS/Methods/WGS_Dosage_Anomalies/WGDosage_Analysis_Fall2016/\"\n\n#Read matrices, tranche (99%), and retain top 10% of libraries\nNHLBI <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/NHLBI.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))))\nFINNS <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/Finns.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))))\nCMG <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/CMG.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))))\nAFIB <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/AFib.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))))\nSFARIplus <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/SFARIplus.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))))\nSFARIminus <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/SFARIminus.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))))\nliWGS <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/liWGS.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))))\n# MiSeq <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/MiSeq.liWGS.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))))\n\n#Merge into PCR-free, PCR-plus, and ALL\nPLUS <- WGD.matrix.merge(list(FINNS,SFARIplus,liWGS))\nMINUS <- WGD.matrix.merge(list(NHLBI,AFIB,SFARIminus))\nALL <- WGD.matrix.merge(list(PLUS,MINUS,CMG))\n\n#Test plot of chr1 examples - all cohorts, 10% most extreme libraries\njpeg(\"~/scratch/test_libType.jpg\",width=1800,height=900)\nplot(c(0,max(NHLBI$mat$end)),c(-0.35,0.35),type=\"n\",xaxs=\"i\",yaxs=\"i\",\n     ylab=\"Normalized Coverage Deviance\",xlab=\"Coordinate (chr1)\",yaxt=\"n\")\naxis(2,at=seq(-.35,.35,0.05),labels=paste(seq(-35,35,5),\"%\",sep=\"\"),las=2)\nabline(h=seq(-1,1,by=0.05),col=\"gray75\",lty=2)\nabline(h=0,col=\"black\",lwd=3)\napply(NHLBI$res[,4:ncol(NHLBI$res)],2,function(vals){\n  points(smooth.spline(NHLBI$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"red\",alpha=0.1))\n})\napply(FINNS$res[,4:ncol(FINNS$res)],2,function(vals){\n  points(smooth.spline(FINNS$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"blue\",alpha=0.1))\n})\napply(AFIB$res[,4:ncol(AFIB$res)],2,function(vals){\n  points(smooth.spline(AFIB$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"red\",alpha=0.1))\n})\napply(SFARIminus$res[,4:ncol(SFARIminus$res)],2,function(vals){\n  points(smooth.spline(SFARIminus$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"red\",alpha=0.1))\n})\napply(SFARIplus$res[,4:ncol(SFARIplus$res)],2,function(vals){\n  points(smooth.spline(SFARIplus$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"blue\",alpha=0.1))\n})\napply(CMG$res[,4:ncol(CMG$res)],2,function(vals){\n  points(smooth.spline(CMG$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"cyan\",alpha=0.05))\n})\napply(liWGS$res[,4:ncol(liWGS$res)],2,function(vals){\n  points(smooth.spline(liWGS$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"cyan\",alpha=0.1))\n})\ndev.off()\n\n#Plot once per cohort\nsapply(1:7,function(i){\n  x <- list(NHLBI,FINNS,CMG,AFIB,SFARIplus,SFARIminus,liWGS)[[i]]\n  xn <- c(\"NHLBI\",\"FINNS\",\"CMG\",\"AFIB\",\n            \"SFARIplus\",\"SFARIminus\",\"liWGS\")[i]\n  jpeg(paste(\"~/scratch/\",xn,\".jpg\",sep=\"\"),width=1800,height=900)\n  plot(c(0,max(x$mat$end)),c(-0.4,0.4),type=\"n\",xaxs=\"i\",yaxs=\"i\",main=xn,\n       ylab=\"Normalized Coverage Deviance\",xlab=\"Coordinate (chr1)\",yaxt=\"n\")\n  axis(2,at=seq(-.4,.4,0.05),labels=paste(seq(-40,40,5),\"%\",sep=\"\"),las=2)\n  abline(h=seq(-1,1,by=0.05),col=\"gray75\",lty=2)\n  abline(h=0,col=\"black\",lwd=3)\n  apply(x$res[,4:ncol(x$res)],2,function(vals){\n    points(smooth.spline(x$mat$start,vals,spar=0.3),type=\"l\",\n           col=adjustcolor(\"red\",alpha=0.25))\n  })\n  dev.off()\n})\n\n\n# #Plot examples\n# for(ID in names(NHLBI$mat)[-c(1:3)]){\n#   WGD.sample.plot(NHLBI,ID,\"~/scratch/WGD_testing/\")\n# }\n# for(ID in names(FINNS$mat)[-c(1:3)]){\n#   WGD.sample.plot(FINNS,ID,\"~/scratch/WGD_testing/\")\n# }\n#\n# #Fingerprint testM\n# testM.fingerprint <- WGD.matrix.fingerprint(testM,heatmap=T,\n#                                             OUTDIR=\"~/scratch/\",\n#                                             filename=\"WGD_siWGS_vs_PCRfree.jpg\")\n#\n\n#Plot all SFARI minus\nSFARIminus <- WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/SFARIminus.1.normCov.10kb.matrix.bed.gz\",sep=\"\")))\njpeg(\"~/scratch/SFARI_phase1_allLibraries.jpg\",width=1800,height=900)\nplot(c(0,max(SFARIminus$mat$end)),c(-0.35,0.35),type=\"n\",xaxs=\"i\",yaxs=\"i\",\n     ylab=\"Normalized Coverage Deviance\",xlab=\"Coordinate (chr1)\",yaxt=\"n\",\n     main=\"SFARI Phase 1 (PCR-), All Libraries (n=1916)\")\naxis(2,at=seq(-.35,.35,0.05),labels=paste(seq(-35,35,5),\"%\",sep=\"\"),las=2)\nabline(h=seq(-1,1,by=0.05),col=\"gray75\",lty=2)\nabline(h=0,col=\"black\",lwd=3)\napply(SFARIminus$res[,4:ncol(SFARIminus$res)],2,function(vals){\n  points(smooth.spline(SFARIminus$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"red\",alpha=0.1))\n})\ndev.off()\n\n#Plot all 10X (with SFARI+ pilot for comparison)\nSFARIplus <- WGD.matrix.slice(WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/SFARIplus.1.normCov.10kb.matrix.bed.gz\",sep=\"\"))),slice=50/160)\nMcC.10X <- WGD.matrix.tranche(WGD.matrix.read(paste(WRKDIR,\"test/McC_10X.1.normCov.10kb.matrix.bed.gz\",sep=\"\")))\njpeg(\"~/scratch/McCarroll_10X.wSFARIpilots.WGD.chr1.jpg\",width=1800,height=900)\nplot(c(0,max(McC.10X$mat$end)),c(-0.35,0.35),type=\"n\",xaxs=\"i\",yaxs=\"i\",\n     ylab=\"Normalized Coverage Deviance\",xlab=\"Coordinate (chr1)\",yaxt=\"n\",\n     main=\"McCarroll 10X, All Libraries (n=50)\")\naxis(2,at=seq(-.35,.35,0.05),labels=paste(seq(-35,35,5),\"%\",sep=\"\"),las=2)\nabline(h=seq(-1,1,by=0.05),col=\"gray75\",lty=2)\nabline(h=0,col=\"black\",lwd=3)\napply(McC.10X$res[,4:ncol(McC.10X$res)],2,function(vals){\n  points(smooth.spline(McC.10X$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"red\",alpha=0.35))\n})\napply(SFARIplus$res[,4:ncol(SFARIplus$res)],2,function(vals){\n  points(smooth.spline(SFARIplus$mat$start,vals,spar=0.3),type=\"l\",\n         col=adjustcolor(\"blue\",alpha=0.35))\n})\ndev.off()\n\n",
    "created" : 1471204345304.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "473648391",
    "id" : "1081A5D4",
    "lastKnownWriteTime" : 1479058054,
    "last_content_update" : 1479058054991,
    "path" : "~/Desktop/RCollins/Talkowski_Local/NGS/Methods/WGS_Dosage_Anomalies/WGDR_development/WGDR_devCode.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}